<!DOCTYPE html>
<html lang="de">
<head>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="robots" content="noindex, nofollow" />
<style type="text/css">
body { font-family:helvetica,arial,sans-serif; line-height:1.4; }
a { text-decoration:none; color:#059c8c; font-weight:600; }
pre { background-color:#d9e5ec; width:90%; }
code { font-size:larger; white-space:nowrap; }
h1 { font-size:x-large; }
h2 { font-size:large; }
h3 { font-size:medium; }
</style>
<title>Aufgabe 2 Systemprogrammierung</title>
</head>
<body>

<h1>Systemprogrammierung - AIN/2<br>
<span style="font-size:smaller">Sommersemester 2023</span></h1>
<hr>

<h2>&Uuml;bungsaufgabe 2: C Arrays</h2>
<p>
<b>Abgabe bis 20./21.4.2023</b></p>

<h3>Migration von Java nach C: Bubblesort</h3>
<p>
In Programmiertechnik&nbsp;1 haben wir ein Java-Programm Bubblesort
besprochen, das beliebig viele ganze Zahlen in ein Array einliest und
aufsteigend sortiert wieder ausgibt.
Das hier vorgegebene Java-Programm
<a href="Bubblesort.java" download>Bubblesort.java</a>
ist so erweitert, dass es die zu sortierenden Zahlen entweder von der
Standardeingabe einliest oder mit dem Zufallsgenerator erzeugt.
Stellen Sie dieses Java-Programm auf C um:</p>
<ul>
<li>
Die Quelldatei soll <code>bubblesort.c</code> hei&szlig;en.</li>
<li>
Der Kopf des Hauptprogramms muss
<code>&nbsp;int&nbsp;main(int&nbsp;argc,&nbsp;char&nbsp;*argv[])&nbsp;</code>
lauten. Dabei ist <code>argc</code> der C-Ersatz f&uuml;r die Instanzvariable
<code>args.length</code> beim Java-Array.</li>
<li>
Die Entsprechung zum Java-Ausdruck
<code>&nbsp;Integer.parseInt(args[0])&nbsp;</code>
ist der C-Ausdruck <code>&nbsp;atoi(argv[1])&nbsp;</code>.</li>
<li>
Verwenden Sie die Bibliotheksfunktion <code>malloc</code> oder <code>calloc</code>
zum Reservieren des Speichers f&uuml;r das Array.</li>
<li>
Den Zufallsgenerator der C-Standardbibliothek initialisieren Sie mit
<code>&nbsp;srand((unsigned&nbsp;int)&nbsp;time(NULL))&nbsp;</code>
und die n&auml;chste Zufallszahl erhalten Sie mit dem Funktionsaufruf
<code>&nbsp;rand()</code>.</li>
</ul>
<p>
Denken Sie an die Fehlerbehandlung nach der Speicherreservierung
und beim Einlesen der ganzen Zahlen
sowie an die Freigabe des Speichers am Programmende.</p>

<br>

<h3>Manueller Test</h3>
<p>
Speichern Sie die Datei <a href="Makefile" download>&cudarrr;&nbsp;Makefile</a>
in Ihr Arbeitverzeichnis der Aufgabe&nbsp;2
und verwenden Sie zum Testen die Befehle:</p>
<pre>
    javac Bubblesort.java
    java Bubblesort 10
    make bubblesort
    ./bubblesort 10
    valgrind ./bubblesort 10
    make cppcheck
</pre>
<p>
Testen Sie Ihre C-Programm mit unterschiedlichen Array-Gr&ouml;&szlig;en
und Eingaben, auch mit extremen und falschen Werten:</p>
<ul>
<li>
Verh&auml;lt sich das C-Programm bei <u>allen</u> Eingaben wie das Java-Programm?</li>
<li>
Funktioniert die Fehlerbehandlung bei Speicherreservierung und Einlesen?</li>
<li>
Meldet <code>valgrind</code> Fehler?</li>
<li>
Meldet <code>cppcheck</code> Probleme?</li>
</ul>
<p>
Bessern Sie gegebenenfalls nach.</p>

<br>

<h3>Automatisierter Test</h3>
<p>
Verwenden Sie die folgenden Linux-Befehle, um zu pr&uuml;fen,
ob Ihr <code>bubblesort</code> &uuml;berhaupt richtig sortiert:</p>
<pre>
    ./bubblesort 1000 &lt; /dev/null | tail -1000 &gt; out.txt
    sort -n out.txt | diff - out.txt
</pre>
<p>
Das Umlenken der Standardein-/augabe mit &lt; und | haben Sie schon
im ersten Semester kennengelernt. Die Angabe von <code>/dev/null</code>
als Eingabequelle bewirkt, dass <code>bubblesort</code> bei allen Leseversuchen
ein Eingabeende erh&auml;lt, als h&auml;tten Sie <code>Strg-D</code> eingegeben.
Informationen zu den verwendeten Linux-Befehlen mit ihren Optionen und
Argumenten erhalten Sie mit</p>
<pre>
    man tail
    man sort
    man diff
</pre>
<p>
oder &uuml;ber die auf der Literaturseite der Vorlesung genannten
Internetseiten.</p>
<ul>
<li>
Was gibt die obige Befehlsfolge im Terminal aus, wenn Ihr
<code>bubblesort</code> richtig sortiert hat?</li>
</ul>
 
<br>

<!--
<h3>Debugger</h3>
<p>
F&uuml;hren Sie Ihr Programm mit dem Debbugger <code>ddd</code> zeilenweise aus
und beobachten Sie, wie die Zahlen im Array vertauscht werden.</p>
<pre>
    ddd bubblesort&amp;
</pre>
<p>
<em>
Hinweis:<br>
Schlagen Sie in der
<a href="https://www.gnu.org/software/ddd/manual/"><code>ddd</code>-Dokumentation</a>
nach, wie man sich alle Elemente eines Arrays anzeigen lassen kann.
</em></p>

<br>
-->

<h3>Laufzeitmessung</h3>
<p>
Verwenden Sie die folgenden Linux-Befehle, um die Laufzeit Ihres Programms
zu messen:</p>
<pre>
    time java Bubblesort 1000 < /dev/null > /dev/null
    time ./bubblesort 1000 < /dev/null > /dev/null
</pre>
<p>
Das Schl&uuml;sselwort <code>time</code> veranlasst die Unix-Shell,
die Ausf&uuml;hrungszeit des dahinter folgenden Kommandos zu messen.
Relevant ist f&uuml;r Sie die Zeile mit der <code>user</code>-Zeit.
Informationen dazu finden Sie auf den Handbuchseiten des
Kommandozeileninterpreters (siehe &nbsp;<code>man&nbsp;bash&nbsp;</code>
oder entsprechende Internetseiten).</p>
<ul>
<li>
W&auml;chst die Ausf&uuml;hrungszeit tats&auml;chlich quadratisch
mit der Array-Gr&ouml;&szlig;e?</li>
<li>
Ist das Java-Programm oder das C-Programm schneller?
K&ouml;nnen Sie sich den Unterschied erkl&auml;ren?</li>
</ul>
<p>
F&uuml;hren Sie zur Beantwortung der beiden Fragen eine Messreihe
mit den Array-Gr&ouml;&szlig;en 1000, 10000 und 100000 durch.</p>
<p>
&Uuml;bersetzen Sie das C-Programm auch mal mit der Optimierungsoption
<code>-O2</code> (Buchstabe Gro&szlig;-O, nicht die Ziffer Null):
</p>
<pre>
    make "CC=gcc -g -O2" clean all
</pre>
<ul>
<li>Ist das optimierte Programm erkennbar schneller?</li>
</ul>
<p>
Wiederholen Sie zur Beantwortung der Fragen die obige Messreihe.
Verwenden Sie clean, um das nicht optimierte und das optimierte Programm
nicht durcheinander zu bringen.
<code>make clean all</code> l&ouml;scht das aktuelle Programm und 
erzeugt die nicht optimierte Version, und
<code>make "CC=gcc -g -O2" clean all</code>
l&ouml;scht das aktuelle Programm und erzeugt die optimierte Version.
</p>

<br>

<h3>Protokoll</h3>
<p>
Erstellen Sie ein Protokoll Ihres automatisierten Tests
und Ihrer Laufzeitmessungen. Gehen sie dazu so vor wie in
<a href="../Aufgabe1/Aufgabe1.html">Aufgabe&nbsp;1</a> beschrieben.
Nennen Sie die Protokolldatei <code>protokoll-aufgabe2.txt</code> und
erg&auml;nzen Sie darin Ihre Antworten auf alle obigen Fragen.</p>

<br>

<h3>Abgabe</h3>
<p>
F&uuml;hren Sie Ihr Programm und Ihre Protokolldatei vor.</p>
<!--
<p>
Verpacken Sie alle Dateien Ihrer L&ouml;sung in ein Archiv:</p>
<pre>
    tar cvzf aufgabe2.tar.gz Makefile bubblesort.c protokoll-aufgabe2.txt
</pre>
<p>
Laden Sie das Archiv dann in Moodle hoch (siehe dort).</p>
-->
<p>
<em>
Hinweis:<br>
Der Compiler <code>gcc</code> darf f&uuml;r Ihr Programm 
keine Fehler oder Warnungen mehr ausgeben.<br>
Ihr Programm muss au&szlig;erdem ordentlich formatierte sein.
Bessern Sie die Formatierung gegebenenfalls mit <code>astyle</code> nach:<br>
<code>&nbsp;&nbsp;astyle -p -H --style=ansi bubblesort.c</code></em></p>

<br>

<h3>Freiwillige Zusatzaufgabe (1 Bonuspunkt pro Spiegelpunkt)</h3>
<p>
Betrachten Sie die folgenden zwei <code>for</code>-Schleifen,
die beide <code>n</code> mal auf ein Array zugreifen:</p>
<pre>
    for (int i = 0; i &lt; n; ++i)
    {
        int r = rand() % n;
        a[r] = r;
    }

    for (int i = 0; i &lt; n; ++i)
    {
        int r = rand() % n;
        a[i] = r;
    }
</pre>
<ul>
<li>
<p>
Welche der beiden Schleifen ist bei sehr gro&szlig;em <code>n</code> schneller?</p>
<p>
Testen Sie Ihre Hypothese mit zwei kleinen C-Programmen.
Nutzen Sie wie im Pflichtteil das <code>time</code>-Kommando.</p>
</li>
<li>
Erkl&auml;ren Sie, wie der Laufzeitunterschied zwischen den beiden Schleifen zustande kommt.
Sie brauchen f&uuml;r die Antwort Kenntnisse &uuml;ber Rechnerarchtekturen.
Der entscheidende Begriff f&auml;ngt mit dem Buchstaben C an.
</li>
</ul>

<br>

<hr>
<address style="font-size:smaller; text-align:left; float:left;">
<a href="http://www-home.htwg-konstanz.de/~drachen/">Prof. Dr. H. Drachenfels</a>
<br>
<a href="https://www.htwg-konstanz.de">Hochschule Konstanz</a> -
<a href="https://www.htwg-konstanz.de/info/impressum">Impressum</a> -
<a href="https://www.htwg-konstanz.de/info/datenschutzerklaerung/">Datenschutzerkl&auml;rung</a>
</address>
<em style="font-size:smaller; text-align:right; float:right;">
Letzte &Auml;nderung: 1.3.2023
</em>

</body>
</html>

